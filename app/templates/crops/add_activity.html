{% extends "base.html" %}

{% block title %}
<span data-translate="add_activity">‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</span> - {{ crop.crop_type }} - <span data-translate="smart_agriculture_app">‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§´‡§∏‡§≤ ‡§¶‡•á‡§ñ‡§≠‡§æ‡§≤ ‡§∏‡§π‡§æ‡§Ø‡§ï</span>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50">
    <div class="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <div class="bg-white rounded-lg shadow p-8">
            <div class="mb-6">
                <h1 class="text-3xl font-bold text-gray-900 mb-2">
                    <span data-translate="add_activity">‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</span>
                </h1>
                <p class="text-gray-600">
                    {{ crop.crop_type.title() }} {% if crop.variety %}({{ crop.variety }}){% endif %} - 
                    <span data-translate="farm">‡§ñ‡•á‡§§</span>: {{ crop.farm.farm_name }}
                </p>
            </div>
            
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="mb-4 p-4 rounded-lg flash-message {% if category == 'success' %}bg-green-100 border border-green-400 text-green-700{% else %}bg-red-100 border border-red-400 text-red-700{% endif %}">
                            {{ message }}
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
            
            <form method="POST" class="space-y-6">
                
                <!-- Activity Type -->
                <div>
                    <label for="activity_type" class="block text-sm font-medium text-gray-700 mb-2">
                        <span data-translate="activity_type">‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø ‡§ï‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞</span> *
                    </label>
                    <select id="activity_type" 
                            name="activity_type" 
                            required
                            onchange="updateActivityForm()"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500">
                        <option value="">-- <span data-translate="select_activity_type">‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç</span> --</option>
                        <option value="irrigation">üíß <span data-translate="irrigation">‡§∏‡§ø‡§Ç‡§ö‡§æ‡§à</span></option>
                        <option value="fertilizer">üåø <span data-translate="fertilizer">‡§â‡§∞‡•ç‡§µ‡§∞‡§ï</span></option>
                        <option value="pesticide">üõ°Ô∏è <span data-translate="pesticide">‡§ï‡•Ä‡§ü‡§®‡§æ‡§∂‡§ï</span></option>
                        <option value="harvesting">üåæ <span data-translate="harvesting">‡§ï‡§ü‡§æ‡§à</span></option>
                        <option value="other">üìã <span data-translate="other">‡§Ö‡§®‡•ç‡§Ø</span></option>
                    </select>
                </div>
                
                <!-- Description -->
                <div>
                    <label for="description" class="block text-sm font-medium text-gray-700 mb-2">
                        <span data-translate="description">‡§µ‡§ø‡§µ‡§∞‡§£</span> *
                    </label>
                    <textarea id="description" 
                              name="description" 
                              rows="3" 
                              required
                              placeholder="‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø ‡§ï‡§æ ‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç..."
                              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500"></textarea>
                    <div id="descriptionHelp" class="mt-1 text-sm text-gray-500">
                        <span data-translate="description_help">‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø ‡§ï‡§æ ‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç</span>
                    </div>
                </div>
                
                <!-- Quantity -->
                <div>
                    <label for="quantity" class="block text-sm font-medium text-gray-700 mb-2">
                        <span data-translate="quantity">‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ</span>
                    </label>
                    <input type="text" 
                           id="quantity" 
                           name="quantity" 
                           placeholder="‡§â‡§¶‡§æ‡§π‡§∞‡§£: 5mm ‡§™‡§æ‡§®‡•Ä, 10kg ‡§Ø‡•Ç‡§∞‡§ø‡§Ø‡§æ"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500">
                    <div id="quantityHelp" class="mt-1 text-sm text-gray-500">
                        <span data-translate="quantity_help">‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ ‡§î‡§∞ ‡§á‡§ï‡§æ‡§à ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç</span>
                    </div>
                </div>
                
                <!-- Scheduled Date -->
                <div>
                    <label for="scheduled_date" class="block text-sm font-medium text-gray-700 mb-2">
                        <span data-translate="scheduled_date">‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§ø‡§§ ‡§§‡§æ‡§∞‡•Ä‡§ñ</span> *
                    </label>
                    <input type="date" 
                           id="scheduled_date" 
                           name="scheduled_date" 
                           required
                           min="{{ today.strftime('%Y-%m-%d') }}"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500">
                    <p class="mt-1 text-sm text-gray-500">
                        <span data-translate="scheduled_date_help">‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø ‡§ï‡§¨ ‡§ï‡§∞‡§®‡•Ä ‡§π‡•à, ‡§µ‡§π ‡§§‡§æ‡§∞‡•Ä‡§ñ ‡§ö‡•Å‡§®‡•á‡§Ç</span>
                    </p>
                </div>
                
                <!-- Activity-specific recommendations -->
                <div id="recommendations" class="bg-blue-50 border border-blue-200 rounded-lg p-4 hidden">
                    <h3 class="font-medium text-blue-800 mb-2">
                        <span data-translate="recommendations">‡§∏‡•Å‡§ù‡§æ‡§µ</span>
                    </h3>
                    <div id="recommendationContent" class="text-sm text-blue-700"></div>
                </div>
                
                <!-- Action Buttons -->
                <div class="flex flex-col sm:flex-row gap-4 pt-6">
                    <button type="submit" 
                            class="flex-1 bg-green-600 text-white py-3 px-6 rounded-lg hover:bg-green-700 transition duration-300">
                        ‚ûï <span data-translate="add_activity">‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</span>
                    </button>
                    
                    <a href="{{ url_for('crops.view', crop_id=crop.id) }}" 
                       class="flex-1 border border-gray-300 text-gray-700 py-3 px-6 rounded-lg hover:bg-gray-50 transition duration-300 text-center">
                        <span data-translate="cancel">‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</span>
                    </a>
                </div>
            </form>
            
            <!-- Quick Add Buttons -->
            <div class="mt-8 pt-6 border-t border-gray-200">
                <h3 class="font-medium text-gray-700 mb-4">
                    <span data-translate="quick_add">‡§§‡•ç‡§µ‡§∞‡§ø‡§§ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</span>
                </h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                    <button onclick="quickAdd('irrigation', '‡§Ü‡§ú ‡§∏‡§ø‡§Ç‡§ö‡§æ‡§à ‡§ï‡§∞‡•á‡§Ç', '5mm')" 
                            class="p-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition duration-300 text-center">
                        <div class="text-2xl mb-1">üíß</div>
                        <div class="text-xs text-gray-600"><span data-translate="irrigation">‡§∏‡§ø‡§Ç‡§ö‡§æ‡§à</span></div>
                    </button>
                    
                    <button onclick="quickAdd('fertilizer', '‡§â‡§∞‡•ç‡§µ‡§∞‡§ï ‡§°‡§æ‡§≤‡•á‡§Ç', '10kg')" 
                            class="p-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition duration-300 text-center">
                        <div class="text-2xl mb-1">üåø</div>
                        <div class="text-xs text-gray-600"><span data-translate="fertilizer">‡§â‡§∞‡•ç‡§µ‡§∞‡§ï</span></div>
                    </button>
                    
                    <button onclick="quickAdd('pesticide', '‡§ï‡•Ä‡§ü‡§®‡§æ‡§∂‡§ï ‡§õ‡§ø‡§°‡§º‡§ï‡§æ‡§µ', '1 ‡§≤‡•Ä‡§ü‡§∞')" 
                            class="p-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition duration-300 text-center">
                        <div class="text-2xl mb-1">üõ°Ô∏è</div>
                        <div class="text-xs text-gray-600"><span data-translate="pesticide">‡§ï‡•Ä‡§ü‡§®‡§æ‡§∂‡§ï</span></div>
                    </button>
                    
                    <button onclick="quickAdd('other', '‡§Ö‡§®‡•ç‡§Ø ‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø', '')" 
                            class="p-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition duration-300 text-center">
                        <div class="text-2xl mb-1">üìã</div>
                        <div class="text-xs text-gray-600"><span data-translate="other">‡§Ö‡§®‡•ç‡§Ø</span></div>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Set today's date as default
document.addEventListener('DOMContentLoaded', function() {
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('scheduled_date').value = today;
});

function updateActivityForm() {
    const activityType = document.getElementById('activity_type').value;
    const recommendationsDiv = document.getElementById('recommendations');
    const recommendationContent = document.getElementById('recommendationContent');
    const descriptionHelp = document.getElementById('descriptionHelp');
    const quantityHelp = document.getElementById('quantityHelp');
    
    // Clear previous recommendations
    recommendationsDiv.classList.add('hidden');
    
    // Update help texts and recommendations based on activity type
    switch(activityType) {
        case 'irrigation':
            descriptionHelp.innerHTML = '<span data-translate="irrigation_desc_help">‡§∏‡§ø‡§Ç‡§ö‡§æ‡§à ‡§ï‡•Ä ‡§µ‡§ø‡§ß‡§ø ‡§î‡§∞ ‡§∏‡§Æ‡§Ø ‡§ï‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§¶‡•á‡§Ç</span>';
            quantityHelp.innerHTML = '<span data-translate="irrigation_quantity_help">‡§™‡§æ‡§®‡•Ä ‡§ï‡•Ä ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ mm ‡§Ø‡§æ ‡§≤‡•Ä‡§ü‡§∞ ‡§Æ‡•á‡§Ç ‡§¶‡•á‡§Ç</span>';
            recommendationsDiv.classList.remove('hidden');
            recommendationContent.innerHTML = `
                <ul class="list-disc list-inside space-y-1">
                    <li>‡§∏‡•Å‡§¨‡§π ‡§Ø‡§æ ‡§∂‡§æ‡§Æ ‡§ï‡•á ‡§∏‡§Æ‡§Ø ‡§∏‡§ø‡§Ç‡§ö‡§æ‡§à ‡§ï‡§∞‡•á‡§Ç</li>
                    <li>‡§´‡§∏‡§≤ ‡§ï‡•Ä ‡§Ö‡§µ‡§∏‡•ç‡§•‡§æ ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§™‡§æ‡§®‡•Ä ‡§¶‡•á‡§Ç</li>
                    <li>‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§Æ‡•á‡§Ç ‡§®‡§Æ‡•Ä ‡§ï‡•Ä ‡§ú‡§æ‡§Ç‡§ö ‡§ï‡§∞‡•á‡§Ç</li>
                </ul>
            `;
            break;
            
        case 'fertilizer':
            descriptionHelp.innerHTML = '<span data-translate="fertilizer_desc_help">‡§â‡§∞‡•ç‡§µ‡§∞‡§ï ‡§ï‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§î‡§∞ ‡§°‡§æ‡§≤‡§®‡•á ‡§ï‡•Ä ‡§µ‡§ø‡§ß‡§ø ‡§¨‡§§‡§æ‡§è‡§Ç</span>';
            quantityHelp.innerHTML = '<span data-translate="fertilizer_quantity_help">‡§â‡§∞‡•ç‡§µ‡§∞‡§ï ‡§ï‡•Ä ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ kg ‡§Æ‡•á‡§Ç ‡§¶‡•á‡§Ç</span>';
            recommendationsDiv.classList.remove('hidden');
            recommendationContent.innerHTML = `
                <ul class="list-disc list-inside space-y-1">
                    <li>‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£ ‡§ï‡•á ‡§Ü‡§ß‡§æ‡§∞ ‡§™‡§∞ ‡§â‡§∞‡•ç‡§µ‡§∞‡§ï ‡§¶‡•á‡§Ç</li>
                    <li>‡§Ø‡•Ç‡§∞‡§ø‡§Ø‡§æ ‡§∏‡•Å‡§¨‡§π ‡§ï‡•á ‡§∏‡§Æ‡§Ø ‡§°‡§æ‡§≤‡•á‡§Ç</li>
                    <li>‡§â‡§∞‡•ç‡§µ‡§∞‡§ï ‡§°‡§æ‡§≤‡§®‡•á ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§∏‡§ø‡§Ç‡§ö‡§æ‡§à ‡§ï‡§∞‡•á‡§Ç</li>
                </ul>
            `;
            break;
            
        case 'pesticide':
            descriptionHelp.innerHTML = '<span data-translate="pesticide_desc_help">‡§ï‡•Ä‡§ü‡§®‡§æ‡§∂‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§î‡§∞ ‡§õ‡§ø‡§°‡§º‡§ï‡§æ‡§µ ‡§ï‡•Ä ‡§µ‡§ø‡§ß‡§ø ‡§¨‡§§‡§æ‡§è‡§Ç</span>';
            quantityHelp.innerHTML = '<span data-translate="pesticide_quantity_help">‡§ï‡•Ä‡§ü‡§®‡§æ‡§∂‡§ï ‡§ï‡•Ä ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ ‡§≤‡•Ä‡§ü‡§∞ ‡§Æ‡•á‡§Ç ‡§¶‡•á‡§Ç</span>';
            recommendationsDiv.classList.remove('hidden');
            recommendationContent.innerHTML = `
                <ul class="list-disc list-inside space-y-1">
                    <li>‡§∂‡§æ‡§Æ ‡§ï‡•á ‡§∏‡§Æ‡§Ø ‡§õ‡§ø‡§°‡§º‡§ï‡§æ‡§µ ‡§ï‡§∞‡•á‡§Ç</li>
                    <li>‡§π‡§µ‡§æ ‡§® ‡§ö‡§≤‡§®‡•á ‡§™‡§∞ ‡§õ‡§ø‡§°‡§º‡§ï‡§æ‡§µ ‡§ï‡§∞‡•á‡§Ç</li>
                    <li>‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§â‡§™‡§ï‡§∞‡§£ ‡§™‡§π‡§®‡•á‡§Ç</li>
                </ul>
            `;
            break;
            
        case 'harvesting':
            descriptionHelp.innerHTML = '<span data-translate="harvesting_desc_help">‡§ï‡§ü‡§æ‡§à ‡§ï‡•Ä ‡§µ‡§ø‡§ß‡§ø ‡§î‡§∞ ‡§∏‡§Æ‡§Ø ‡§ï‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§¶‡•á‡§Ç</span>';
            quantityHelp.innerHTML = '<span data-translate="harvesting_quantity_help">‡§ï‡§ü‡§æ‡§à ‡§ï‡§æ ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞‡§´‡§≤ ‡§è‡§ï‡§°‡§º ‡§Æ‡•á‡§Ç ‡§¶‡•á‡§Ç</span>';
            break;
            
        default:
            descriptionHelp.innerHTML = '<span data-translate="description_help">‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø ‡§ï‡§æ ‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç</span>';
            quantityHelp.innerHTML = '<span data-translate="quantity_help">‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ ‡§î‡§∞ ‡§á‡§ï‡§æ‡§à ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç</span>';
    }
}

function quickAdd(type, description, quantity) {
    document.getElementById('activity_type').value = type;
    document.getElementById('description').value = description;
    document.getElementById('quantity').value = quantity;
    updateActivityForm();
}
</script>
{% endblock %}
